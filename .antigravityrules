# 통합 개발 가이드라인 (Unified Development Guidelines) v2.1

## 1. 핵심 행동 수칙 (Critical Core Rules)
이 섹션의 규칙은 프로젝트의 최우선 순위이며, 어떤 상황에서도 타협할 수 없습니다.

### 1.1 언어 및 아티팩트 작성 (Language Mandate)
- **전면 한국어 사용**: 모든 답변, 코드 설명, 오류 메시지, 작업 계획(Plan), 사고 과정(Thoughts), 태스크 요약은 반드시 **한국어**로 작성해야 합니다.
- **아티팩트 언어 제한**: walkthrough, task, implementation plan 등 모든 생성 문서는 한국어로만 작성되어야 합니다. 영문 아티팩트는 허용되지 않습니다.

### 1.2 사고 도구 의무화 (Sequential Thinking Mandate)
- **선(先) 사고, 후(後) 행동**: 복잡한 문제 해결, 코드 분석, 계획 수립, 또는 사용자의 명시적인 질문에 답변할 때는 반드시 `sequential-thinking` 도구를 먼저 호출해야 합니다.
  - 단순 인사/확인을 제외한 모든 실질적 작업 전 호출 필수.
  - 코드를 작성/수정하기 전 계획 검증 필수.
  - 답변 전 논리적 근거 마련 필수.

## 2. 도구 사용 및 설정 (Tool Configuration)

### 2.1 Sequential Thinking 상세 설정
- **기능**: 문제를 동적이고 깊이 있게 분석하며, 가설 검증 및 경로 수정을 수행합니다.
- **사용 원칙**:
  - 필요한 사고 횟수(`totalThoughts`)를 유동적으로 조절하며, 불확실할 경우 "끝"이라고 생각되어도 사고를 추가하십시오.
  - 이전 사고를 자유롭게 비판, 수정(`isRevision`), 또는 분기(`branchFromThought`) 하십시오.
  - 최종적으로 **단 하나의 정답(ideally correct answer)**을 도출할 때까지 반복하십시오.

### 2.2 Context7 라이브러리 도구
- **resolve-library-id** (필수 선행): 문서를 조회하기 전 무조건 먼저 호출하여 ID를 확보합니다.
- **get-library-docs**: 확보된 ID로 문서를 조회하며 적절한 Mode를 선택합니다.

## 3. 프로젝트 구현 규칙 & 컨벤션 (Project Rules & Conventions)

### 3.1 메타 규칙 (Meta Rules)
- **지속적 개선**: 사용자와의 대화에서 반복적으로 요구되는 사항이 발견되면, 즉시 이 가이드라인을 업데이트합니다.

### 3.2 UI/UX 가이드라인

#### 0. 일반 원칙: 비파괴적 UI 개선 (Non-Destructive UI Evolution)
- **Legacy Layout Stability**: 새로운 기능을 추가하거나 버그를 수정할 때, 기존의 잘 잡힌 레이아웃(수평 폼, 컨트롤 높이 등)을 훼손해서는 안 됩니다.
- **Simulation**: CSS 클래스나 스타일을 변경하기 전, 주변 요소의 정렬이나 크기에 미칠 영향을 먼저 Sequential Thinking으로 시뮬레이션하십시오.

#### A. 모달 및 삭제 동작 (Modal & Deletion Protocols)
- **닫기 메커니즘**: ESC 키 지원 필수 (`stopPropagation` 포함), 배경 클릭 닫기 비활성화.
- **[Critical] 맥락 인지형 안전 삭제 (Context-Aware Safe Deletion)**:
  - **Guarded Deletion**: 삭제 대상에 종속된 데이터(예: 재고가 있는 창고, 결제된 전표)가 존재하면 삭제를 **원천 차단**하거나, **경고와 함께 종속 내역**을 명시해야 합니다.
  - **Context-Aware Message**:
    - **Bad**: "정말 삭제하시겠습니까?"
    - **Good**: "12월 25일 '삼성전자'와의 매입 전표(관련 재고 포함)를 삭제하시겠습니까?"
  - 대상 식별 정보 없이 단순한 확인 메시지는 금지합니다.

#### B. 데이터 표시 표준 (Data Formatting)
- **포맷**: `${품목명} ${중량}kg (${등급})` 형식 준수. 중량의 불필요한 소수점 제거.
- **용어**: 라벨은 한국어 사용 ("입고일자" -> "매입 일자").
- **[New] 날짜 표시 (Date Formatting)**:
  - **Compact View** (리스트/카드): `MM-DD` (예: `12-25`)
  - **Detail View** (상세/수정): `YYYY-MM-DD`
  - **Input**: 모바일 호환성을 위해 `<input type="date">` 또는 전용 Picker 사용.

#### C. 스타일링 및 UX 패턴 (Styling & UX Patterns)
- **폰트 크기**: 업무용 `0.9rem`, 목록 `0.85rem`~`0.9rem`.
- **페이지 헤더**: `App.css`의 `.page-header`, `.page-title` 클래스 사용.
- **[Critical] 인라인 스타일 금지 (Inline Style Ban)**:
  - 최종 코드에는 `style={{ ... }}` 객체 사용을 엄격히 금지합니다 (동적 값 제어 제외).
  - 반드시 CSS 파일의 클래스를 사용하십시오.
- **[New] Sticky & Silent Interaction**:
  - **Sticky Header**: 리스트 필터/헤더는 스크롤 시 상단 고정(`sticky`).
  - **Silent Reload**: 데이터 리패치 시 스크롤 위치 유지 필수.

#### D. 모바일 드래그 앤 드롭 표준 (Mobile Drag & Drop Standards)
1. **Stable Callbacks**: `touchMove/End`는 `useCallback(fn, [])`으로 참조 유지.
2. **Ref State Access**: `useState` 대신 `useRef`로 최신 값 참조.
3. **Direct DOM Manipulation**: 드래그 요소는 `ref.style.transform` 직접 수정 (60fps).
4. **Cached Rects**: `getBoundingClientRect`는 드래그 시작 시 캐싱.
5. **Browser Blockers**: `e.preventDefault()`, `.touch-none`, `.no-select` 필수 적용.

#### E. [New] 모바일 최적화 및 밀도 (Mobile Optimization & Density)
- **Standard 35 (Balanced High-Visibility)**:
  - 입력 필드 최소 높이 **1.2rem** (터치 영역 확보).
  - 주요 액션 버튼 비율 **5:5** 또는 **Full Width**.
- **Single Window Policy**: 모바일에서는 한 번에 하나의 메인 작업창만 유지 (중첩 지양).
- **Columnar Flattened Card**: 모바일 리스트는 테이블 대신 **열(Column) 형태 카드** 레이아웃 적용.

### 3.3 아키텍처 가이드라인

#### Front-end
- **모달 스타일 재사용**: `TradeDetailModal`, `ConfirmModal` 등의 표준 패턴을 재사용합니다.

#### Back-end (API)
- **안정성**: `LEFT JOIN` 권장 (누락 방지).
- **라우팅**: 고정 경로를 파라미터 경로보다 먼저 정의.

## 4. 트러블슈팅 및 보고 (Troubleshooting & Reporting)

### 4.1 환경적 요인 보고 프로토콜 (Environmental Issue Protocol)
- **유령 버그 대응**: 코드/데이터 전수 조사 후에도 원인 미발견 시 **"환경/하드웨어 요인(Environment Factor)"**으로 분류.
- **조치**: 무리한 코드 수정 지양, 사용자에게 환경 점검(브라우저/OS/캐시) 제안.
