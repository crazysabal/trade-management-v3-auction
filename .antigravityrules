# 프로젝트 규칙 & 컨벤션 (Project Rules & Conventions)

## 0. 규칙 업데이트 지침 (Meta Rules)
- **지속적 개선**: 사용자와의 대화에서 **반복적으로 요구되는 사항**이 발견되면, 즉시 이 파일에 해당 내용을 추가하여 영구적인 규칙으로 정립해야 합니다.
- **적극적 반영**: "매번 말하지 않아도 알 수 있도록" 이 파일을 살아있는 문서로 유지합니다.

## UI/UX 가이드라인 (사용자 경험)

### 모달 동작 (Modal Behavior)
1. **닫기 메커니즘**:
   - **ESC 키**: 모든 모달에서 ESC 키로 빠르게 닫을 수 있어야 합니다 (**필수**).
   - **배경 클릭**: 실수로 닫혀서 작업 중인 데이터가 날아가는 것을 방지하기 위해, 배경 클릭으로 닫히는 기능은 **비활성화**해야 합니다 (또는 명시적인 확인 필요).

2. **중첩 모달 처리 (이벤트 전파)**:
   - **이벤트 전파 중단**: 모달의 `ESC` 키 이벤트 핸들러는 반드시 `e.stopPropagation()`과 `e.preventDefault()`를 포함해야 합니다.
     ```javascript
     const handleKeyDown = (e) => {
       if (e.key === 'Escape') {
         e.preventDefault();
         e.stopPropagation(); // 부모 모달이 같이 닫히는 것 방지
         onClose();
       }
     };
     ```
   - **우선순위 로직**: 여러 모달이 겹쳐 있을 때, 아래쪽(부모) 모달은 위쪽(자식) 모달이 열려있는지 확인하고 동작을 양보해야 합니다.

### 데이터 표시 표준 (Data Formatting Standards)
1. **품목명 표시**:
   - 품목명, 중량, 등급을 읽기 좋은 하나의 문자열로 결합합니다.
   - **형식**: `${품목명} ${중량}kg (${등급})`
   - **Null 처리**: 값이 없는 부분은 생략하며, 공백 처리를 자연스럽게 합니다.

2. **중량(무게) 표시**:
   - **깔끔한 숫자**: 불필요한 소수점이나 뒤따르는 0은 제거합니다.
   - **방법**: `parseFloat()` 또는 `Number()` 사용.
   - **예시**: `5.00` -> `5`, `5.50` -> `5.5`
   - **코드 패턴**: 
     ```javascript
     const weightText = p.weight ? ` ${parseFloat(p.weight)}kg` : '';
     ```

3. **날짜/용어 표기**:
   - **라벨 명명**: 비즈니스 용어 통일성을 위해 "입고일자" 대신 "**매입 일자**"를 사용합니다.
   - **언어**: 모든 UI 메시지와 라벨은 **한국어**를 사용합니다.

4. **폰트 크기 표준 (Font Size)**:
   - **업무용 데이터**: `0.9rem` (약 14px)을 표준으로 하여 정보 밀도와 가독성의 균형을 맞춥니다.
   - **목록 화면**: `0.85rem ~ 0.9rem` 권장.
   - **입력 양식**: `0.9rem` 권장. (1rem은 너무 커서 공간 효율이 떨어짐)

5. **페이지 헤더 표준 (Page Header)**:
   - **구조**: 인라인 스타일 대신 `App.css`에 정의된 `.page-header`, `.page-title` 클래스를 반드시 사용합니다.
   - **예시**:
     ```jsx
     <div className="page-header">
       <h1 className="page-title">📋 페이지 제목</h1>
       <div className="page-header-actions">...버튼들...</div>
     </div>
     ```

## 프론트엔드 아키텍처

### 스타일링 (Styling)
1. **모달 일관성**:
   - 새로운 상세 보기 모달을 만들 때는 `TradeDetailModal`의 구조와 CSS 클래스(`trade-detail-modal-*`)를 재사용하여 시각적 통일감을 유지합니다.

## 백엔드 가이드라인

### API 설계
1. **에러 핸들링**:
   - **상세 메시지**: 디버깅을 돕기 위해 JSON 응답에 구체적인 에러 메시지를 포함합니다.
   - **형식**: `res.status(500).json({ success: false, message: '사용자 알림 메시지: ' + error.message });`

2. **안정성 (Robustness)**:
   - **방어적 조인**: 데이터 무결성이 완벽하지 않을 수 있는 경우(예: 삭제된 참조), 목록 조회가 실패하지 않도록 `INNER JOIN` 대신 `LEFT JOIN`을 권장합니다.

3. **라우팅 (Routing)**:
   - **순서 중요**: 특정 경로(예: `/recent`)는 파라미터 경로(예: `/:id`)보다 **반드시 먼저** 정의해야 404 에러나 잘못된 핸들러 실행을 막을 수 있습니다.
